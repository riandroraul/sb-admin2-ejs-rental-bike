<!-- Begin Page Content -->
<div class="container-fluid">
  <!-- Page Heading -->
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Edit Profile</h1>
  </div>

  <!-- Content Row -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Profile Information</h6>
        </div>
        <div class="card-body">
          <form
            method="post"
            action="/update-profile"
            enctype="multipart/form-data"
          >
            <div class="form-group text-center">
              <img
                src="/img/undraw_profile.svg"
                class="profile-img"
                alt="Profile Picture"
                id="profilePicture"
              />
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="inputGroupFileAddon01"
                    >Upload
                  </span>
                </div>
                <div class="custom-file">
                  <input
                    type="file"
                    name="profile_picture"
                    class="custom-file-input <%= errors.find(e => e.path === 'profile_picture') ? 'is-invalid' : '' %>"
                    id="inputProfilePict"
                    aria-describedby="inputGroupFileAddon01"
                  />
                  <label class="custom-file-label" for="inputProfilePict"
                    >Choose file
                  </label>
                </div>
                <div id="profile_picture" class="invalid-feedback">
                  asdasdasd asdas asd sad asd
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="name">Fullname</label>
              <input
                type="text"
                class="form-control <%= errors.find(e => e.path === 'name') ? 'is-invalid' : '' %>"
                id="name"
                name="name"
                value="<%= formData.name || user.name %>"
              />
              <% if (errors.find(e => e.path === 'name')) { %>
              <div id="name" class="invalid-feedback">
                <%= errors.find(e => e.path === 'name').msg %>
              </div>
              <% } %>
            </div>
            <div class="form-group">
              <label for="email">Email address</label>
              <input
                type="text"
                class="form-control <%= errors.find(e => e.path === 'email') ? 'is-invalid' : '' %>"
                id="email"
                name="email"
                value="<%= formData.email || user.email %>"
              />
              <% if (errors.find(e => e.path === 'email')) { %>
              <div id="email" class="invalid-feedback">
                <%= errors.find(e => e.path === 'email').msg %>
              </div>
              <% } %>
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input
                type="tel"
                class="form-control <%= errors.find(e => e.path === 'phone') ? 'is-invalid' : '' %>"
                id="phone"
                name="phone"
                value="<%= formData.phone || user.phone %>"
              />
              <% if (errors.find(e => e.path === 'phone')) { %>
              <div id="phone" class="invalid-feedback">
                <%= errors.find(e => e.path === 'phone').msg %>
              </div>
              <% } %>
            </div>
            <div class="form-group">
              <label for="address">Address</label>
              <textarea
                class="form-control <%= errors.find(e => e.path === 'address') ? 'is-invalid' : '' %>"
                id="address"
                name="address"
                rows="3"
                value="<%= formData.address || user.address %>"
              >
              </textarea>
              <% if (errors.find(e => e.path === 'address')) { %>
              <div id="address" class="invalid-feedback">
                <%= errors.find(e => e.path === 'address').msg %>
              </div>
              <% } %>
            </div>
            <button type="submit" class="btn btn-primary btn-block">
              Update Profile
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- /.container-fluid -->

<script>
  $(document).ready(function () {
    $("#inputProfilePict").on("change", function (event) {
      if (event.target.files && event.target.files[0]) {
        let reader = new FileReader();
        reader.onload = function (event) {
          $("#profilePicture").attr("src", event.target.result);
        };
        reader.readAsDataURL(event.target.files[0]);

        // update file with file name
        let fileName = event.target.files[0].name;
        console.log(this);
        $(this).next(".custom-file-label").html(fileName);
      }
    });
  });
</script>
